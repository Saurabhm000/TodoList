let submitbutton = document.querySelector(".submitbutton");
let inputtext = document.querySelector(".inputtext");
let ul = document.querySelector(".unorderedlist");

// Function to create a task and store it in localStorage
function createTask(text) {
    // Create the task element
    let list = document.createElement("li");

    // Create a span to wrap the text so we can toggle completion on just the text
    let taskText = document.createElement("span");
    taskText.textContent = text;
    list.appendChild(taskText); // Append the text inside the list item

    // Append the list item to the unordered list
    ul.appendChild(list);

    // Create and append the delete button
    let delbut = document.createElement("button");
    delbut.innerHTML = "X";
    delbut.classList.add("deletebutton");
    list.appendChild(delbut);

    // Event listener for the delete button
    delbut.addEventListener("click", (e) => {
        e.stopPropagation(); // Prevent the click event from bubbling up to the list item
        list.remove();
        updateLocalStorage(); // Update localStorage after deletion
    });

    // Event listener for toggling task completion
    list.addEventListener("click", () => {
        taskText.classList.toggle("completed"); // Toggle only on the text part (span)
        updateLocalStorage(); // Update localStorage after completion toggle
    });

    // Update localStorage after task creation
    updateLocalStorage();
}

// Function to update localStorage with the current list of tasks
function updateLocalStorage() {
    let tasks = [];
    let listItems = ul.querySelectorAll("li");

    listItems.forEach(item => {
        let taskText = item.querySelector("span").textContent;
        let isCompleted = item.querySelector("span").classList.contains("completed");
        tasks.push({ text: taskText, completed: isCompleted });
    });

    localStorage.setItem("tasks", JSON.stringify(tasks)); // Save tasks to localStorage
}

// Function to load tasks from localStorage and render them
function loadTasks() {
    let storedTasks = localStorage.getItem("tasks");
    if (storedTasks) {
        let tasks = JSON.parse(storedTasks);
        tasks.forEach(task => {
            createTask(task.text); // Create each task from the stored data
            if (task.completed) {
                let taskText = ul.lastElementChild.querySelector("span");
                taskText.classList.add("completed"); // Mark as completed if it was saved as completed
            }
        });
    }
}

// Event listener for the submit button (click)
submitbutton.addEventListener("click", () => {
    const text = inputtext.value.trim();
    if (text !== "") {
        createTask(text);
        inputtext.value = ''; // Clear the input field
    } else {
        alert("Please Enter Text");
    }
});

// Event listener for the "Enter" key (keydown)
inputtext.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
        const text = inputtext.value.trim();
        if (text !== "") {
            createTask(text);
            inputtext.value = ''; // Clear the input field
        } else {
            alert("Please Enter Text");
        }
    }
});

// Load tasks from localStorage when the page loads
window.addEventListener("load", loadTasks);
